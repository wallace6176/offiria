S={jQuery:window.jQuery,extend:function(a){this.jQuery.extend(this,a)}};S.extend({text:[],path:[],utils:{getMessageId:function(b){var a=$(b).data("message_id");if(a!=undefined){return a}a=$(b).parents("li.message-item").attr("id");a=a.match(/^\w+_([0-9]+)$/)[1];return a},getGroupId:function(b){var a=$(b).data("group_id");if(a!=undefined){return a}return 0},getCommentId:function(b){var a=$(b).parents("div.comment-item").attr("id");a=a.match("([0-9]+)")[0];return a},setupOptionSelect:function(c){var d=$(c).attr("value");var b=$(c).data("target-input");var a=$(c).html();$('form input[name="'+b+'"]').val(d);$('a.dropdown-toggle[href="#'+b+'"]').html(a+' <b class="caret">');return false},sprintf:function(c,b){var b=$.makeArray(arguments);b.splice(0,1);var a=function(e,d){e=e.replace(/%[0-9]\$s/,d[0]);d.splice(0,1);if(e.match(/%[0-9]\$s/)){a(e,d)}return e};return a(c,b)},hightlight:function(b){var a=$(b);a.css("background-color","#ffffaa");a.animate({backgroundColor:"#FFFFFF"},4000)},buttonWaitingForAjax:function(a){$button=$(a);$button.one("ajaxStart",function(){$button.attr("disabled",true)});$button.one("ajaxComplete",function(){$button.attr("disabled",false)});$button.click(function(b){b.preventDefault()})}},uploader:{init:function(b,a){var c=new qq.FileUploader({multiple:false,element:document.getElementById(b),action:S.path["system.upload"],debug:true,listElement:document.getElementById(a),fileTemplate:'<li style="list-style: none outside none;margin-left:0px;padding-left: 8px;"><div class="message-content-file"><span class="qq-upload-file"></span><span class="qq-upload-spinner"></span><span class="qq-upload-size"></span><a class="qq-upload-cancel" href="#">Cancel</a><span class="qq-upload-failed-text">Failed</span><input type="hidden" name="attachment[]" value="" /></div></li>',onComplete:function(g,f,d){var e=c._getItemByFileId(g);$(e).find("input").val(d.file_id);$(e).find("div.message-content-file").append('<span class="qq-upload-remove"><a file_id="'+d.file_id+'" href="#removeAttachment">Remove</a></span>');$(e).find("div.message-content-file").attr("data-filename",f)}})},selectFile:function(a){$("#"+a+" input=[name='file']").click();return false},getHandler:function(){if(qq.UploadHandlerXhr.isSupported()){return qq.UploadHandlerXhr}else{return qq.UploadHandlerForm}}},preview:{modal:false,show:function(b){var a=$(b).attr("data-file_id");var d=$(b).attr("data-filename");var c=S.utils.getMessageId(b);if($("#preview-modal").length>0){$("#preview-modal").remove()}$("body").append('<div id="preview-modal" class="modal hide modal-wide" style="max-height:900px;width: 750px; margin: -250px 0 0 -375px;bottom:30px;top:280px"><div class="modal-header"><button type="button" class="close" data-dismiss="modal">Ã—</button><h3>'+d+'</h3></div><div class="modal-body" style="bottom:0px;max-height:900px">Loading</div></div>');$("#preview-modal div.modal-body").html('<img style="width: 220px;   height: 20px;   position: absolute;   left: 50%;   top: 50%;    margin-left: -140px;   margin-top: -10px;" src="/templates/offiria/images/hloading.gif">');$("#preview-modal").modal({backdrop:true,show:true});S.preview.load(a,c);return false},load:function(a,b){$.ajax({type:"POST",url:S.path["system.preview"],data:{file_id:a},dataType:"json",cache:false,success:function(c){S.message.isViewed(b,a,"file");if(c.reload){if($("div#preview-modal").css("display")=="block"){S.preview.load(c.file_id,b)}}$("div#preview-modal div.modal-body").css("height",$("#preview-modal").height()-90);$("div#preview-modal div.modal-body").html(c.html)}})}},alert:{hide:function(b){$(b).closest("div.alert").slideUp();var a=$(b).closest("div.alert").data("alert_id");$.ajax({type:"POST",url:S.path["system.hidealert"],data:{alert_id:a},dataType:"json",cache:true,success:function(c){}})}},notification:{intervals:null,pHash:null,gHash:null,update:function(){$.ajax({type:"POST",url:S.path["notification.update"],dataType:"json",data:{pHash:S.notification.pHash},cache:false,success:function(d){if(d.logout!=undefined){alert("Session expired. Please login again");clearInterval(S.notification.intervals);window.location=S.path["system.root"]}else{if($.isEmptyObject(d.notification)){return}else{if(d.pHash!=S.notification.pHash){S.notification.pHash=d.pHash;if(typeof d.notification!=undefined){var b=0;$.each(d.notification,function(e,f){if(f!=0){$("span#"+e).html(f);$("span#"+e).show();$("ol#stream div."+e+" a").html(f+" new updates");$("ol#stream div."+e+" a").attr("limit",f)}else{$(".side-notification a").html(S.text["label.no.new.notification"]);$(".side-notification span").hide();$("span#"+e).hide();$("ol#stream div."+e).hide()}b+=+f});b=d.notification.company_updates;if(b!=undefined&&b!=0){var c=(b>0)?"("+b+")":"";document.title=c+" "+document.title.replace(/\(\d+\)\s?/,"");$(".side-notification span").html(b);$(".side-notification a").html(S.text["label.new.notification"]);$(".side-notification span").show()}}if(typeof d.data_content!=undefined){var a="";$.each(d.data_content,function(e,f){if(f.length>0){a+=f.replace(/<\/?ul>/g,"")}$(e).attr("data-content",f)});$(".side-notification a").attr("data-content","<ul>"+a+"</ul>")}if(typeof d.comments!=undefined){$.each(d.comments,function(e,f){if(f!=0){$("a#"+e+"_link").find(".comment-notice").show()}else{$("a#"+e+"_link").find(".comment-notice").hide()}})}}}}}})}},search:{init:function(){}},stream:{init:function(){$('#stream a[href="#showNew"]').live("click",function(){var b=S.utils.getGroupId(this);var a=$(this).attr("limit");$.ajax({type:"POST",url:S.path["message.load"],data:{group_id:b,limit:a},dataType:"json",cache:false,success:function(c){$(c.html).each(function(e){var f=$(c.html[e]).css("display","none");var d=$("ol#stream li:first");$("ol#stream li.older-stream-saperator").show();$("ol#stream li:first").before(f);$("ol#stream li:first").slideDown("slow")});$("ol#stream div.morebox").slideUp("slow")}});return false})},update:function(a){},post:function(posturl){var type=$('#stream-form input[name="type"][disabled!="disabled"]').val();var trigger="S."+type+'.onSubmit("form#stream-form");';if(eval(trigger)==false){return false}var postData=$("#stream-form").serialize();var activeType=$("#stream-post-tabs li a").attr("href");$(activeType+' :input, #stream-form input[type="submit"]').attr("disabled",true);$("#stream-post-loading").show();$.ajax({type:"POST",url:posturl,data:postData,dataType:"json",success:function(data){$("ol#stream li.older-stream-saperator").show();if($("ol#stream li").length==0){$("ol#stream").html(data.html);$("ol#stream li:first").slideDown("slow")}else{$("ol#stream li:first").before(data.html);$("ol#stream li:first").slideDown("slow")}$(".stream-post").val("");$("#message-box").focus();$("#flash").hide();$("ul#post-attachment-list li").remove();$("div.alert-empty-stream").fadeOut();$("#updated-stream-separator").hide()}}).done(function(data){$("#stream-post-loading").hide();$(activeType+' :input, #stream-form input[type="submit"]').attr("disabled",false);$("#message-box").height($("#message-box").data("original-height"));$("#message-box-page_ifr").height($("#message-box").data("original-height"));S.links.unlink();$("div.stream-loading").remove();trigger="S."+type+".onAfterSubmit( data );";eval(trigger)})},userstats:function(a){$.ajax({type:"POST",url:S.path["stream.update"],data:a}).done(function(b){})}},postbox:{init:function(){$("#message-box").data("original-height",$("#message-box").height());$('.stream-post-tabs li[class!="li-text"]').click(function(){var b=$('#stream-form textarea[name="message"][value!=""]').val();$('#stream-form textarea[name="message"][value!=""]').val("");$(".stream-post-tabs li").removeClass("active");$(this).addClass("active");$(".tab-content").hide();$(".tab-content").find("textarea,input").attr("disabled",true);var a=$(this).find("a").attr("href");$(a).show();$(this).find("a").blur();$(a).find('textarea[name="message"]').val(b);$(a).find("textarea,input").attr("disabled",false);if(a=="#stream-post-page"){tinyMCE.execCommand("mceAddControl",true,"message-box-page")}$(this).find(".end-date").datepicker("enable").datepicker("option","minDate",0);return false});$(".stream-post-tabs li.active").click();$("#stream-post-update #message-box").focus(function(a){var b=$(this).parents(".minimized");b.removeClass("minimized")});$(".stream-post-tabs li").click(function(){$("#stream-post-message").removeClass("minimized")});$("input.start-date").datepicker({dateFormat:"yy-mm-dd",onSelect:function(h,f){var b=$(this).val();var g=$(this).parent().next().find(".end-date").val()||"";if(g!=""){var c=b.split(/-/);b=new Date(c[0],c[1],c[2]);var a=g.split(/-/);g=new Date(a[0],a[1],a[2]);if(b>g){$(this).parent().next().find(".end-date").val($(this).val())}}var d=$('#stream-form input[name="type"][disabled!="disabled"]').val();if(d=="event"){var e=$(this).datepicker("getDate");e=new Date(e.getTime());e.setDate(e.getDate());$(this).parent().next().find(".end-date").datepicker("enable").datepicker("option","minDate",e).datepicker("setDate",e);$('a[href="#selectTime"]').trigger("click");$('select[name="start_time"]').trigger("change")}}});$("input.end-date").datepicker({dateFormat:"yy-mm-dd",onSelect:function(f,d){var e=$(this).val();var b=$(this).parent().prev().find(".start-date").val()||"";var c=b.split(/-/);b=new Date(c[0],c[1],c[2]);var a=e.split(/-/);e=new Date(a[0],a[1],a[2]);if(b>e){$(this).parent().prev().find(".start-date").val($(this).val())}$('select[name="start_time"]').trigger("change")}});$("#message-box").val("")}},tag:{init:function(){$(".tag-add").live("click",function(a){a.preventDefault();S.tag.add(this)});$(".tag-cancel").live("click",function(a){S.tag.showTagEdit(this,false)});$(".tag-remove").live("click",function(a){S.tag.remove(this)});$('a[href="#editTags"]').live("click",function(a){$(".tag-element span a").click(function(b){b.preventDefault()});S.tag.showTagEdit(this);S.tag.bindTypeAhead(this);a.preventDefault()})},showTagEdit:function(b,a){if(typeof a==="undefined"||a===null){a=true}var d=S.utils.getMessageId(b);var c=$("li#message_"+d);S.enqueueMessage();if(a){c.find(".message-content-tag").hide();c.find(".message-content-tag-edit").show();c.find(".tag-input").focus()}else{c.find(".message-content-tag").show();c.find(".message-content-tag-edit").hide()}},add:function(c){var e=S.utils.getMessageId(c);var d=$("li#message_"+e);var b=$(c).parents(".tag-container-parent").find(".tag-input").val();var a=d.find(".message-content-tag-error");S.enqueueMessage();if($.trim(b).length===0){S.enqueueMessage(S.text["error.tag.assign.empty"],"error",a)}else{if(!/^[a-z0-9\ \'-]+$/i.test(b)){S.enqueueMessage(S.text["error.tag.unsupported.characters"],"error",a)}else{if($.trim(b).length>20){S.enqueueMessage(S.utils.sprintf("<b>%1$s-character</b> limit reached",20),"error",a)}else{$.ajax({type:"POST",url:S.path["tag.add"],data:{message_id:e,tag:b},cache:false,dataType:"json",success:function(g){d.find(".message-content-tag-parent").replaceWith(function(){return $(g.html)});var f=$("li#message_"+e);f.find(".message-content-tag").hide();f.find(".message-content-tag-edit").show();f.find(".tag-input").focus();S.tag.bindTypeAhead(f.find(".tag-input"))}});return false}}}},remove:function(b){var a=$(b).closest(".tag-element").find("a:first");var d=S.utils.getMessageId(b);var c=$("li#message_"+d);$.ajax({type:"POST",url:S.path["tag.delete"],data:{message_id:d,tag:a.text()},cache:false,dataType:"json",success:function(f){c.find(".message-content-tag-parent").replaceWith(function(){return $(f.html)});var e=$("li#message_"+d);e.find(".message-content-tag").hide();e.find(".message-content-tag-edit").show();S.tag.bindTypeAhead(e.find(".tag-input"));S.enqueueMessage()}})},bindTypeAhead:function(a){var d=S.utils.getMessageId(a);var c=$("li#message_"+d);var b=c.find(".tag-input");b.on("keypress",function(f){switch(f.keyCode){case 9:case 13:f.preventDefault();S.tag.add(this);break}});b.typeahead({source:function(f,e){$.ajax({type:"POST",url:S.path["tag.autocomplete"],data:{query:e},cache:false,dataType:"json",success:function(h){var g=[];c.find(".tag-container li").each(function(k,j){g.push($(j).find("a").text())});var i=new Array();i=jQuery.grep(h,function(j){return jQuery.inArray(j,g)<0});f.process(i)}})},onselect:function(e){S.tag.add(this.$element)},onenterkey:function(){S.tag.add(this.$element)}})}},topic:{init:function(a){S.topic.done(a.find(".topic-edit-change"))},update:function(b){var d=$(b).parents(".topic-container-parent").find(".stream-topics-element");var c=$(b).parents(".topic-container-parent").find(".stream-form-topic-value");var a=[];d.each(function(e,f){var g=$(f).text();a.push(g.substr(0,g.length-1))});c.val(a.join(","))},add:function(e){var d=$(e).parents(".topic-container-parent").find(".topic-input");var a=$(e).parents(".topic-container-parent").find(".topic-container");var f="#";var c="stream-topics-element";var b="stream-topics-close";var g=d.val().split(" ");d.val("");g.each(function(j,h){if(j.length>0){var k=$("<li />",{"class":c,html:'<a href="'+f+'">'+j+"</a>"}).appendTo(a);var i=$("<span />",{"class":b,html:"x"}).appendTo(k)}});S.topic.update(e)},close:function(a){$(a).parent().remove()},edit:function(c){var d=$(c).parents(".topic-container-parent").find(".stream-topics-close");var a=$(c).parents(".topic-container-parent").find(".topic-input");var b=$(c).parents(".topic-container-parent").find(".topic-add");b.show();a.show();d.show();$(c).html("Done");$(c).click(function(){S.topic.done(this)})},done:function(c){var d=$(c).parents(".topic-container-parent").find(".stream-topics-close");var a=$(c).parents(".topic-container-parent").find(".topic-input");var b=$(c).parents(".topic-container-parent").find(".topic-add");b.hide();a.hide();d.hide();$(c).html(S.text.edit);$(c).click(function(){S.topic.edit(this)})}},message:{init:function(){$(".message-item").live("mouseenter",function(){$(this).find(".message-remove").show();$(this).find(".hover-show").show()});$(".message-item").live("mouseleave",function(){$(this).find(".message-remove").hide();$(this).find(".hover-show").hide()});$('a[href="#filterMassage"]').live("click",function(){$(this).closest("ul").find("li").removeClass("active");$(this).closest("li").addClass("active");var filter=$(this).data("filter-data");$("div.stream-loading").remove();$("#update").before('<div class="stream-loading"></div>');$.ajax({type:"POST",url:S.path["message.filter"],data:filter,dataType:"json",cache:true,success:function(data){if($("#stream-tab li.active a").attr("href")==data.type){var html=$(data.html).find("#update").html();$("#update").html(html);html=$(data.html).find(".pagination").html();if(html==null||html==undefined){html=$(data.html).eq(7).html()}$(".pagination").html(html);$(".stream-loading").remove()}$(".sidebar-right-inner").attr("style","");if($(".sidebar-right-inner").length&&$(".sidebar-left-inner").length){var $sidebarLeftInner=$(".sidebar-left-inner");var $sidebarRightInner=$(".sidebar-right-inner");var higherHeight=Math.max($sidebarLeftInner.height(),$sidebarRightInner.height());$sidebarRightInner.height(higherHeight)}}});$(this).blur();return false});$('a[href="#filterMentions"], a[href="#filterAll"], a[href="#filterMine"], a[href="#filterDue"]').live("click",function(){$(this).closest("ul").find("li").removeClass("active");$(this).closest("li").addClass("active");var group_id=S.utils.getGroupId(this);var filter={group_id:0,user_id:0,search:"",overdue:""};var user_id=$(this).attr("user_id");var search=$(this).attr("search");var overdue=$(this).attr("overdue");if(group_id!=undefined){filter.group_id=group_id}if(search!=undefined){filter.search=search}if(user_id!=undefined){filter.user_id=user_id}if(overdue!=undefined){filter.overdue=overdue}filter.type=$("#stream-tab li.active a").attr("href");$("div.stream-loading").remove();$("#update").before('<div class="stream-loading"></div>');$.ajax({type:"POST",url:S.path["message.filter"],data:filter,dataType:"json",cache:true,success:function(data){if($("#stream-tab li.active a").attr("href")==data.type){var html=$(data.html).find("#update").html();$("#update").html(html);html=$(data.html).find(".pagination").html();$(".pagination").html(html);$(".stream-loading").remove()}}});$(this).blur();return false});$('a[href="#showMore"]').live("click",function(){var filter={group_id:0,user_id:0,search:"",limitstart:0};var group_id=S.utils.getGroupId(this);var user_id=$(this).attr("user_id");var search=$(this).attr("search");var limitstart=$(this).attr("limitstart");if(group_id!=undefined){filter.group_id=group_id}if(search!=undefined){filter.search=search}if(user_id!=undefined){filter.user_id=user_id}if(limitstart!=undefined){filter.limitstart=limitstart}$.ajax({type:"POST",url:S.path["message.filter"],data:filter,dataType:"html",cache:true,success:function(data){var html=$(data).find("#stream").html();$("#stream").append(html)}});return false});$('div.message-remove a.remove, div.message-meta a[href="#remove"]').live("click",function(){var stream_id=S.utils.getMessageId(this);if(confirm(S.text["confirm.message.delete"])){$.ajax({type:"POST",url:S.path["message.delete"],data:{message_id:stream_id},dataType:"json",cache:false,success:function(data){$("li#message_"+data.id).slideUp("slow",function(){$(this).remove()})}})}return false});$('.message-meta a[href="#edit"]').live("click",function(){var editType=$(this).data("type")||"";var stream_id=S.utils.getMessageId(this);$.ajax({type:"POST",url:S.path["message.edit"],data:{message_id:stream_id,edit_type:editType},cache:false,dataType:"json",success:function(data){$("li#message_"+stream_id).html(data.html);$("#stream-post-update textarea").autoGrow({minHeight:60});$("li#message_"+stream_id+" input.start-date").datepicker({dateFormat:"yy-mm-dd",onSelect:function(dateText,inst){var startDate=$(this).val();var endDate=$(this).parent().next().find(".end-date").val()||"";if(endDate!=""){var splitStartDate=startDate.split(/-/);startDate=new Date(splitStartDate[0],splitStartDate[1],splitStartDate[2]);var splitEndDate=endDate.split(/-/);endDate=new Date(splitEndDate[0],splitEndDate[1],splitEndDate[2]);if(startDate>endDate){$(this).parent().next().find(".end-date").val($(this).val())}}var type=$('#stream-form input[name="type"][disabled!="disabled"]').val();if(type=="event"){var selectedStartDate=$(this).datepicker("getDate");selectedStartDate=new Date(selectedStartDate.getTime());selectedStartDate.setDate(selectedStartDate.getDate());$("li#message_"+stream_id+" input.end-date").datepicker("option","minDate",selectedStartDate)}}});$("li#message_"+stream_id+" input.end-date").datepicker({dateFormat:"yy-mm-dd",onSelect:function(dateText,inst){var endDate=$(this).val();var startDate=$(this).parent().prev().find(".start-date").val()||"";var splitStartDate=startDate.split(/-/);startDate=new Date(splitStartDate[0],splitStartDate[1],splitStartDate[2]);var splitEndDate=endDate.split(/-/);endDate=new Date(splitEndDate[0],splitEndDate[1],splitEndDate[2]);if(startDate>endDate){$(this).parent().prev().find(".start-date").val($(this).val())}var type=$('#stream-form input[name="type"][disabled!="disabled"]').val();if(type=="event"){$('select[name="start_time"]').trigger("change")}}});if($("li#message_"+stream_id+" input.end-date").length>0){var selectedStartDate=$("li#message_"+stream_id+" input.start-date").datepicker("getDate");selectedStartDate=new Date(selectedStartDate.getTime());selectedStartDate.setDate(selectedStartDate.getDate());$("li#message_"+stream_id+" input.end-date").datepicker("option","minDate",selectedStartDate)}$("#cWindow input.start-date, #cWindow input.end-date").datepicker({dateFormat:"yy-mm-dd"});$("li#message_"+stream_id+" .stream-message-links-remove").click(function(){$(this).parent(".stream-message-links-edit").remove();$("li#message_"+stream_id+' input[name="linkable_link"]').val("")});eval(data.script)}});return false});$('[name="message-edit-save"]').live("click",function(){var stream_id=S.utils.getMessageId(this);var type=$("#message_"+stream_id+' form[name="message-edit"]').find('input[name="type"]').val();var trigger="S."+type+".onSubmit('#message_"+stream_id+' form[name="message-edit"]\');';if(eval(trigger)==false){return false}$.ajax({type:"POST",url:S.path["message.save"],data:$("#message_"+stream_id+' form[name="message-edit"]').serialize(),cache:false,dataType:"json",success:function(data){$().modal("hide");$("li#message_"+data.id).replaceWith(data.html)}});return false});$('[name="message-edit-cancel"]').live("click",function(){var stream_id=S.utils.getMessageId(this);$.ajax({type:"POST",url:S.path["message.fetch"],data:$("#message_"+stream_id+' form[name="message-edit"]').serialize(),cache:false,dataType:"json",success:function(data){$("li#message_"+data.id).replaceWith(data.html)}});return false});$('.message-content-file a[href="#removeAttachment"]').live("click",function(){var file_id=$(this).attr("file_id");if(file_id!="undefined"){$.ajax({type:"POST",url:S.path["files.delete"],data:{file_id:file_id},cache:false,dataType:"json",success:function(data){if(typeof data.id==="undefined"){$('a[file_id="'+data.file_id+'"]').closest("li").remove()}else{$("li#message_"+data.id).replaceWith(data.html)}}})}else{$(this).parents("li").remove()}return false});$('.message-content-file a[href="#unlinkAttachment"]').live("click",function(){$(this).parents("li.qq-upload-success").remove();return false})},isViewed:function(g,b,d){var c="embed_";var a="file_";var h="video_";var f="link_";var e="slideshare_";switch(d){case"embed":b=c+b;break;case"file":b=a+b;break;case"videos":b=h+b;break;case"link":b=f+b;break;case"slideshare":b=e+b;break;default:b=b}$.ajax({url:S.path["message.viewed"],data:{message_id:g,item_id:b}}).done(function(){console.log("updated")})}},comment:{init:function(){$("textarea[name=comment]").each(function(a,b){});$(".comment-action button").live("click",function(){S.enqueueMessage();var a=$(this).parents("form").find('textarea[name="comment"]');if(!S.validate.element("notEmpty",a,$(a).parent(),"comment")){return false}var c=$(this).parents("form").serialize();var b=S.utils.getMessageId(this);S.utils.buttonWaitingForAjax($(this));$.ajax({type:"POST",url:S.path["comment.add"],data:c,cache:false,success:function(d){$("#message_"+b+' .stream-comment textarea[name="comment"]').val("").attr("style","");$("#message_"+b+" .stream-comment .comment-form").before(d);$("#message_"+b+' a[href="#cancelPostinComment"]').click()}});return false});$('div.comment-item a[href="#delete"]').live("click",function(){var a=S.utils.getCommentId(this);var b=S.utils.getMessageId(this);$.ajax({type:"POST",url:S.path["comment.delete"],data:{comment_id:S.utils.getCommentId(this)},cache:false,dataType:"json",success:function(c){$("#comment-"+a).remove()}});return false});$('.comment-more a[href="#showallcomments"]').live("click",function(){var a=S.utils.getMessageId(this);$.ajax({type:"POST",url:S.path["comment.showall"],data:"message_id="+a,cache:false,success:function(b){$("#message_"+a+" .stream-comment .comment-item").remove();$("#message_"+a+" .stream-comment .comment-more").remove();if($("#message_"+a+" .stream-comment .stream-like").size()>0){$("#message_"+a+" .stream-comment .stream-like").after(b)}else{$("#message_"+a+" .stream-comment").prepend(b)}if(/^#comment-[0-9]+$/i.test(document.location.hash)&&$("#message_"+a).find(document.location.hash).length){S.utils.hightlight(document.location.hash)}}});return false});$('.comment-form a[href="#reply"],.message-item a[href="#comment"]').live("click",function(){var c=S.utils.getMessageId(this);$("#message_"+c+" .stream-comment .comment-form form").show().find("textarea").focus();$("#message_"+c+" .stream-comment .comment-form > span").hide();var a=$("#message_"+c+" .stream-comment .comment-form form textarea");var b="";$.ajax({type:"POST",url:S.path["people.xautocomplete"],cache:false,dataType:"json",success:function(d){b=d;a.typeahead({items:3,menu:'<ul class="people-autocomplete dropdown-menu"></ul>',item:'<li><table><tr><td><img class="people-autocomplete-thumb" /></td><td><a href="#"></a></tr></table></li>',property:"value",matcher:function(e){var g=this.query.lastIndexOf("@");var f=this.query.substring(g).match(/.*(@[a-zA-Z]+).*/i)||"";f=(f&&f[1])?f[1].substring(1):"";return e.toLowerCase().match(".*"+f.toLowerCase()+".*")},source:function(f,e){if(!e.match(/.*@[a-z]+$/i)){f.hide();return false}f.process(b)},highlighter:function(e){var f=this.query.lastIndexOf("@");return e.replace(new RegExp("("+this.query.substring(f+1)+")","ig"),function(g,h){return"<strong>"+h+"</strong>"})},onselect:function(g){var l="@"+g.username;var j=this.query.lastIndexOf("@");var i=".{0,"+j+"}(@[a-z]+)$";var e=this.query.match(i);if(e!=null&&e[1]!=null){var k=this.query.substring(0,j);var f=this.query.substring(j).replace(e[1],l);var h=k+f;if(a.val(h)){a.focus()}}}})}});return false});$('.comment-form a[href="#cancelPostinComment"]').live("click",function(){var a=S.utils.getMessageId(this);$("#message_"+a+" .stream-comment .comment-form form").hide();if($("#message_"+a+" .stream-comment .comment-item").size()>0){$("#message_"+a+" .stream-comment .comment-form > span").show()}return false});$(".comment-item").live("hover",function(){$(this).find(".comment-option").show();$(this).find(".comment-like").parent("span").show()}).live("mouseleave",function(){$(this).find(".comment-option").hide();var a=$(this).find(".comment-like");a.tipsy("hide");if(parseInt(a.html())<=0){a.parent("span").hide()}});$('.comment-item a[href="#commentlike"]').live("click",function(){var a=S.utils.getCommentId(this);$.ajax({type:"POST",url:S.path["like.comment.like"],data:{comment_id:a},dataType:"json",cache:false,success:function(b){var c=$(".message-item #comment-"+a+".comment-item");c.find('a[href="#commentlike"]').html(b.label).attr("href","#commentunlike");c.find(".comment-like").html(b.count)}});return false});$('.comment-item a[href="#commentunlike"]').live("click",function(){var a=S.utils.getCommentId(this);$.ajax({type:"POST",url:S.path["like.comment.unlike"],data:{comment_id:a},dataType:"json",cache:false,success:function(c){var d=$(".message-item #comment-"+a+".comment-item"),b=d.find(".comment-like");d.find('a[href="#commentunlike"]').html(c.label).attr("href","#commentlike");b.html(c.count)}});return false});$(".comment-item .comment-like").live("mouseover",function(){var a=S.utils.getCommentId(this);$.ajax({type:"POST",url:S.path["like.comment.showall"],data:{comment_id:a},dataType:"json",cache:false,success:function(b){var c=$(".message-item #comment-"+a+".comment-item").find(".comment-like");c.attr("original-title",b.likes).tipsy({fallback:"No likes",gravity:"s",trigger:"manual"}).tipsy("show")}});return false})},add:function(a){$.ajax({type:"POST",url:posturl,data:$("#stream-form").serialize()}).done(function(b){$("ol#stream").prepend(b);$("ol#stream li:first").slideDown("slow");$(".stream-post").val("");$("#message-box").focus();$("#flash").hide()})},remove:function(a){$.ajax({type:"POST",url:S.path["comment.delete"],data:{comment_id:S.utils.getCommentId(this)}}).done(function(b){})}},like:{init:function(){$('.message-item a[href="#like"]').live("click",function(){var a=S.utils.getMessageId(this);$.ajax({type:"POST",url:S.path["like.like"],data:"message_id="+a,dataType:"json",cache:false,success:function(b){$("#message_"+a+" .stream-comment .stream-like").show();$("#message_"+a+" .stream-comment .stream-like").html(b.html);$("#message_"+a+' a[href="#like"]').html(b.label).attr("href","#unlike")}});return false});$('.message-meta a[href="#unlike"]').live("click",function(){var a=S.utils.getMessageId(this);$.ajax({type:"POST",url:S.path["like.unlike"],data:"message_id="+a,dataType:"json",cache:false,success:function(b){$("#message_"+a+" .stream-comment .stream-like").show();$("#message_"+a+" .stream-comment .stream-like").html(b.html);$("#message_"+a+' a[href="#unlike"]').html(b.label).attr("href","#like")}});return false});$('.stream-like a[href="#showLikes"]').live("click",function(){var a=S.utils.getMessageId(this);$.ajax({type:"POST",url:S.path["like.showall"],data:"message_id="+a,cache:false,dataType:"json",success:function(b){$("#message_"+a+" .stream-like").html(b.html)}});return false})}},update:{onSubmit:function(b){S.enqueueMessage();if($(b).find('#stream-post-update textarea[name="message"][value!=""]').length==0){var a=($(b).attr("id")=="stream-form")?"reset":$(b);S.enqueueMessage(S.text["error.message.add.empty"],"error",a);return false}return true},onAfterSubmit:function(){}},direct:{init:function(){$(".compose-direct-message").on("click",function(b){var a=$(this);$.ajax({url:S.path["direct.compose"],dataType:"html",success:function(c){$("body").append(c);$("#direct-message-modal").modal({backdrop:true,show:true}).on("hidden",function(){$(this).remove()});S.direct.clearRecipients();var d=a.data("to")||"";if(d.length!==0){S.direct.addRecipient(d)}S.uploader.init("direct-file-uploader","direct-attachment-list");S.direct.bindTypeAhead(".recipient-input")}});b.preventDefault()});$("#stream-form").live("submit",function(a){S.direct.onSubmit(this);a.preventDefault()});$("ol.recipient-list a").live("click",function(a){$(this).closest("li").remove()})},bindTypeAhead:function(a){$(a).typeahead({source:function(c,b){$.ajax({type:"POST",url:S.path["people.autocomplete"],data:{query:b},cache:false,dataType:"json",success:function(e){var d=[];$(".recipient-list").find("li").each(function(h,g){d.push($(g).find("span").text())});var f=new Array();f=jQuery.grep(e,function(g){return jQuery.inArray(g,d)<0});c.process(f)}})},onselect:function(b){S.direct.addRecipient(b)}})},onSubmit:function(d){var c=$("#direct-message-modal");var g=$(d);var h=c.find('input[name="recipient"]');var f=c.find(".recipient-list").children("li");var e=c.find('textarea[name="message"]');var b=g.serialize();var a=c.find(".modal-body");S.enqueueMessage();if(e.val().length===0||f.length===0){S.enqueueMessage("You must fill in all the fields","error",a)}else{$.ajax({type:"POST",url:S.path["message.add"],data:b,dataType:"json",success:function(i){h.val("");e.val("");f.remove();c.find("#direct-attachment-list").html("");c.find("#direct-error").html('<a href="'+S.path["direct.inbox"]+'">Your message</a> has been sent.')}})}},addRecipient:function(b){var a=$(".recipient-input");a.val("");a.before('<li style=""><span title="">'+b+'</span><a class="close small">&times;</a><input type="hidden" value="'+b+'" name="members[]"></li>')},clearRecipients:function(){$(".recipient-list").children().filter("li").remove()}},todo:{getIndex:function(b){var a=$(b).data("todo_index");if(a!=undefined){return a}return $(b).parents("li.todo-item").prevAll().length},init:function(){$('input[name*="todo\\["]').live("keypress",function(e){if(e.which==13){if($(this).val().length>0){if($(this).last().val().length!=0){var inputContainer=$(this).closest("li").clone().get();$(this).closest("ul").append($(inputContainer));$(inputContainer).find("input").val("").focus()}else{$(this).last().focus()}}return false}});$('a[href="#deleteTodo"]').live("click",function(){if($(this).closest("li").siblings().length>0){$(this).closest("li").remove()}return false});$('li.todo-item a[class*="done-todo-item"]:not([class*="readonly"])').live("click",function(e){e.preventDefault();$(this).parents("li.todo-item").toggleClass("todo-done");var todoState=$(this).parents("li.todo-item").hasClass("todo-done")?1:0;var currentIndex=S.todo.getIndex(this);var stream_id=S.utils.getMessageId(this);var todoActionType=$(this).data("type")||"";$.ajax({type:"POST",url:S.path["todo.done"],dataType:"json",data:{message_id:stream_id,state:todoState,item:currentIndex},success:function(data){$("li#message_"+data.id).replaceWith(data.html);var milestoneId=data.milestone_id||false;if(milestoneId&&todoActionType=="list"){$("li#message_"+data.milestone_id).replaceWith(data.html2)}eval(data.script);return false}});return false});$(".complete-todo").live("click",function(){var milestone=$(this).attr("id").split("_")[1];var buttonLI=$(this).parent();var status=$(this).data("status");$.ajax({type:"POST",url:S.path["milestone.completeAll"],dataType:"json",data:{message_id:milestone,status:status},success:function(data){eval(data.script)}});return false});$(".readonly").live("click",function(){return false})},onSubmit:function(d){S.enqueueMessage();if($(d).find('input[name="todo\\[\\]"][value!=""]').length==0){var c=($(d).attr("id")=="stream-form")?"reset":$(d);S.enqueueMessage(S.text["error.todo.add.empty"],"error",c);return false}var b="";var e="";var a="";$(d).find("div.stream-post-todo-list li").each(function(f){if($(this).find("input").hasClass("todo-done")){b+="1,"}else{b+="0,"}e+=$(this).find("input").attr("done_by")+",";a+=$(this).find("input").attr("done_on")+","});$(d).find('input[name="states"]').val(b);$(d).find('input[name="done_by"]').val(e);$(d).find('input[name="done_on"]').val(a);return true},onAfterSubmit:function(){$("#stream-post-todo li:first").siblings().remove();$('#stream-post-todo input[name="todo\\[\\]"]').val("")}},event:{init:function(){$('input[name="event_type"]').live("change",function(){if($(this).prop("checked")){$('div#stream-post-event input[name="start_date"]').attr("placeholder","Due date");$('div#stream-post-event input[name="end_date"]').hide();$('div#stream-post-event input[name="type"]').val("milestone")}else{$('div#stream-post-event input[name="start_date"]').attr("placeholder","Start date");$('div#stream-post-event input[name="end_date"]').show();$('div#stream-post-event input[name="type"]').val("event")}});$('a[href="#selectTime"]').live("click",function(){$(this).hide();$(this).siblings("select").show().trigger("click");return false});var b=$('select[name="start_time"]');var a=$('#stream-post select[name="end_time"]');b.live("change",function(){var p=$(this).find("option:selected");var n=$(this).parents("#stream").find('select[name="end_time"] option');n=(n.length==0)?a.find("option"):n;$(n).attr("disabled",false);$(n).first().attr("selected",true);var q=$(this).parents().find("input.start-date");var m=$(this).parents().find("input.end-date");if(q.datepicker("getDate")!=null&&m.datepicker("getDate")!=null){if(q.datepicker("getDate").getTime()!=m.datepicker("getDate").getTime()){return}}var g,k=24*2-1,e=[],h=true,f,o=false;var j="00";function l(s,r){var i=s+"";return(j.slice(0,r-i.length)+i)}for(g=0;g<=k;g++){f=(h)?"00":"30";hourInLoop=Math.floor(g/2);e.push(l(hourInLoop,2)+":"+f);h=!h}n.attr("disabled",true);var d=$.inArray($(p).val(),e);var c=$(this).parents(".stream-post-time").next().find(".end-date");n.filter(function(i){if($.inArray($(this).val(),e)>d){$(this).attr("disabled",false)}if(e[d+1]==$(this).val()){$(this).attr("selected",true)}if(d+1>=k){if(o){return false}var r=new Date(c.datepicker("getDate").getTime());r.setDate(r.getDate()+1);c.datepicker("option","minDate",r);$(this).parent().find("option").attr("disabled",false);o=true}})});$("li.type_event .btn.follow").live("click",function(){var c=S.utils.getMessageId(this);$.ajax({type:"POST",url:S.path["event.follow"],data:"stream_id="+c,dataType:"json",cache:false,success:function(d){$("li#message_"+d.id).replaceWith(d.html)}});return false});$("li.type_event .btn.unfollow").live("click",function(){var c=S.utils.getMessageId(this);$.ajax({type:"POST",url:S.path["event.unfollow"],data:"stream_id="+c,dataType:"json",cache:false,success:function(d){$("li#message_"+d.id).replaceWith(d.html)}});return false});$(".user-more").live("click",function(c){c.preventDefault();$(this).hide(0,function(){var e=$(this).parent().parent().children(".user-horizontal-list"),f=e.height(),d=e.css("height","auto").height();e.height(f).animate({height:d},300)})})},updateCalendar:function(month,year){$.ajax({type:"POST",url:S.path["event.updateCalendar"],data:{month:month,year:year},dataType:"json",cache:false,success:function(data){$("#stream-calendar").html(data.html);eval(data.script)}})},onSubmit:function(c){S.enqueueMessage();var b=($(c).attr("id")=="stream-form")?"reset":$(c);if(S.validate.isValidDate($(c).find('input[name="start_date"]').val())===false||S.validate.isValidDate($(c).find('input[name="end_date"]').val())===false){S.enqueueMessage("Invalid date is supplied, please check again","error",b);return false}if($(c).find('#stream-post-event textarea[name="message"][value!=""]').length==0){S.enqueueMessage(S.text["error.message.add.empty"],"error",b);return false}var a=$(c).find('input[name="start_date"]').val()+" "+$(c).find('select[name="start_time"]').val();$(c).find('input[name="start_date"]').val(a);var d=$(c).find('input[name="end_date"]').val()+" "+$(c).find('select[name="end_time"]').val();$(c).find('input[name="end_date"]').val(d);return true},onAfterSubmit:function(){$(".stream-post-details input").val("");$('a[href="#selectTime"]').show();$('a[href="#selectTime"]').siblings("select").hide()}},milestone:{init:function(){$('li.type_milestone a[href="#completed"], li.type_milestone a[href="#uncompleted"]').live("click",function(){var b=S.utils.getMessageId(this);var a=($(this).attr("href")=="#completed")?"1":"0";$.ajax({type:"POST",url:S.path["milestone.completed"],data:{message_id:b,status:a},dataType:"json",cache:false,success:function(c){$("li#message_"+c.id).replaceWith(c.html)}});return false})},onSubmit:function(a){},onAfterSubmit:function(a){$.ajax({type:"POST",url:S.path["milestone.updateSelect"],data:{group_id:a.group_id},dataType:"json",cache:false,success:function(b){$('select[name="milestone"]').replaceWith(b.html)}});$("#stream-post-milestone").find(".start-date").val("")}},page:{onSubmit:function(a){$(a).find("#message-box-page").val(tinyMCE.getInstanceById("message-box-page").getContent())},onAfterSubmit:function(){tinyMCE.getInstanceById("message-box-page").setContent("");$('input[name="title"]').val("")}},links:{cleanup:function(){$("#stream-form .loading").remove();$(".stream-message-links").hide();$(".stream-message-links").children().each(function(a,b){if(b.tagName=="IMG"){$(b).attr("src","")}if(b.tagName=="SPAN"||b.tagName=="DIV"){$(b).html("")}})},exception:function(a){var b=/.*((youtu\.?be|slideshare).*|\.(exe|dmg|zip|gz|bz2|dll))$/;return b.test(a)},unlink:function(){S.links.cleanup();$(".stream-message-is-linkable").val(false)}},embed:{init:function(){$("div.message-content-video img").live("click",function(){var a=$(this).attr("embed_id");var b=$(this).attr("embed_type");S.embed.play(a,b,this)})},play:function(b,c,a){message_id=(S.utils.getMessageId(a));$.ajax({type:"POST",url:S.path["video.play"],data:{embed_id:b,embed_type:c},cache:true,dataType:"json",success:function(d){$("#video-"+b).html(d.html);console.log(c);S.message.isViewed(message_id,b,c)}})}},customlist:{init:function(){$("#customlist-form").live("submit",function(a){return S.customlist.onSubmit(this)})},create:function(a){var b=$(a).data("customlist_id");$.ajax({url:S.path["customlist.create"],data:{customlist_id:b},dataType:"html",success:function(c){$("body").append(c);$("#customlist-edit-message-modal").modal({backdrop:true,show:true}).on("hidden",function(){$(this).remove()})}})},onSubmit:function(a){var b=$(a);S.enqueueMessage();if(b.find("#title").val().length===0){S.enqueueMessage("You must fill in the title","error",b.find(".modal-body"));return false}else{return true}}},groups:{init:function(){$('.group-module-members a[href="#showFollowers"]').popmodal({html:true,live:true,placement:"left",reposition:true});$('.group-module-members a[href="#showFollowers"]').click(function(a){a.preventDefault()});$('a[name="groups-edit-save"]').live("click",function(){var a=$(this).closest("#group-create-message-modal");if(a.find('input[name="name"]').val().length!==0){S.utils.buttonWaitingForAjax($(this));$.ajax({type:"POST",url:S.path["group.save"],data:$('form[name="groups-edit"]').serialize(),cache:false,dataType:"json",success:function(b){$().modal("hide");window.location=(b.redirect)}})}else{S.enqueueMessage();S.enqueueMessage("You must fill in the group name","error",a.find(".modal-body"))}return false})},create:function(a){$.ajax({url:S.path["group.edit"],data:"group_id="+S.utils.getGroupId(a),dataType:"html",error:function(d,c,b){},success:function(b){$("body").append(b);$("#group-create-message-modal").modal({backdrop:true,show:true}).on("hidden",function(){$(this).remove()})}})},archive:function(a){if(confirm(S.text["confirm.group.archive"])){$.ajax({type:"POST",url:S.path["group.archive"],data:"group_id="+S.utils.getGroupId(a),cache:false,dataType:"json",success:function(b){window.location=(b.redirect)}})}},unarchive:function(a){$.ajax({type:"POST",url:S.path["group.unarchive"],data:"group_id="+S.utils.getGroupId(a),cache:false,dataType:"json",success:function(b){window.location=(b.redirect)}})},remove:function(a){if(confirm(S.text["confirm.group.delete"])){$.ajax({type:"POST",url:S.path["group.delete"],data:"group_id="+S.utils.getGroupId(a),cache:false,dataType:"json",success:function(b){window.location=(b.redirect)}})}},memberRemove:function(a){if(confirm(S.text["confirm.group.member.remove"])){$.ajax({type:"POST",url:S.path["group.member.remove"],data:{group_id:$(a).data("group_id"),user_id:$(a).data("user_id")},cache:false,dataType:"json",success:function(c){var b=$(a).parent("li");b.slideUp("slow",function(){b.remove();var d=$(".groupMemberList").children("li.newGroupMember").size();if(d<=0){$(".groupMemberList li.newGroupMember-separator").hide()}})}})}return false}},suggest:{started:false,active:false,current:null,startCaret:0,type:"",textarea:null,add:function(b){var a=$(S.suggest.textarea).val();a=a.substring(0,S.suggest.startCaret+1);S.suggest.textarea.val(a+b);S.suggest.stop()},start:function(b){S.suggest.type=b;S.suggest.started=true;if(!S.suggest.active){var a=$("#stream-post div.stream-post-tabs li.active").find("a").attr("href");S.suggest.textarea=$(a).find('textarea[name="message"]');S.suggest.active=true;$(".stream-post-suggest").slideDown();S.suggest.current="";S.suggest.startCaret=$(S.suggest.textarea).caret().start}},stop:function(){if(S.suggest.active){S.suggest.active=false;$(".stream-post-suggest").slideUp()}},update:function(d){var b=d.charCode||d.keyCode;var a=String.fromCharCode(b);if(b>=65&&b<=122){var e=$(S.suggest.textarea).caret().start;var c=$(S.suggest.textarea).val();S.suggest.current=c.substring(S.suggest.startCaret,e+1);S.suggest.current=S.suggest.current+a;$.ajax({type:"POST",url:S.path["system.suggest"],data:{search:S.suggest.current,type:S.suggest.type},dataType:"json",cache:true,success:function(f){$("#stream-post div.stream-post-suggest").html(f.html)}})}else{if(d.keyCode==8||d.keyCode==46){var e=($(S.suggest.textarea).caret().start-1);if(S.suggest.startCaret>=e){S.suggest.stop()}}else{if(a==":"||a=="|"||a=="?"||a==" "||d.keyCode==13){S.suggest.stop()}}}}},maps:{init:function(){if($(".map-fade")!=null||$(".map-heatzone")!=null){$(".map-fade").live("mouseover",function(a){$(this).find("img:eq(2)").fadeOut(0)});$(".map-fade").live("mouseout",function(a){$(this).find("img:eq(2)").fadeIn(0)});$(".map-heatzone").live("mouseover",function(a){$(this).parent().find("img:eq(1)").fadeOut(0)});$(".map-heatzone").live("mouseout",function(a){$(this).parent().find("img:eq(1)").fadeIn(0)})}}},validate:{form:function(c,b,a){$(c).find('input[type="submit"]').click(function(d){d.preventDefault();S.enqueueMessage();var f=[];$(b).each(function(e,g){$.map(g,function(i,h){f.push(S.validate.element(h,i,a))})});if($.inArray(false,f)==-1){$(c).submit()}else{$("body,html").animate({scrollTop:$("#system-message-container").position().top},250)}})},element:function(d,c,b,e){$(c).focus(function(){$(c).parent().removeClass("control-group error")});var a=$(c).siblings("label").text()||$(c).attr("placeholder");a=(e!=null)?e:a;$(c).addClass("control-group error");switch(d){case"email":if(!S.validate.isEmail($(c).val())){S.enqueueMessage(S.utils.sprintf(S.text["error.validate.invalid.email"],a),"error",b);return false}break;case"notEmpty":if(!S.validate.isNotEmpty($(c).val())){S.enqueueMessage(S.utils.sprintf(S.text["error.validate.is.empty"],a),"error",b);return false}break;case"limitChar":if(!S.validate.limitChar($(c))){return false}break}$(c).removeClass("control-group error");return true},isNotEmpty:function(a){var a=a.replace(/\s/g,"");if(a!=null){return a.length>0}return false},isEmail:function(c,b){var a=/[a-z0-9!#$%&'*+\/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+\/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?/;return a.test(c)},isValidDate:function(b){var a=/^(19|20)\d\d[- \/.](0[1-9]|1[012])[- \/.](0[1-9]|[12][0-9]|3[01])$/;return a.test(b)},isValidUrlPredicate:function(b){var a=/([Hh]ttp|[Hh]ttps):\/\/([\w-]+\.)+[\w-]+(\/[\w\-.\/?%&=]*)?/;return a.test(b)},limitChar:function(c){var b,a=c.attr("maxlength");$(c).each(function(d,e){$(e).keydown(function(){b=$(this).val().length;if(b>=a){S.enqueueMessage();S.enqueueMessage(S.utils.sprintf(S.text["error.validate.character.limit"],a),"error")}else{S.enqueueMessage();return true}})});return true}},enqueueMessage:function(d,c,b){b=(!b)?"reset":b;$systemMessageContainer=($("#system-message-container").length==0)?$('<div id="system-message-container" />'):$("#system-message-container");if(b){if(b=="reset"){var a=($(".main-content-inner .breadcrumb").length==0)?$systemMessageContainer.prependTo($(".main-content-inner")):$systemMessageContainer.insertAfter($(".main-content-inner .breadcrumb"))}else{$systemMessageContainer.prependTo(b)}}if(!d){$systemMessageContainer.html("");return}c=(!c)?"message":c;$(document).ready(function(){var h=($("#system-message-container .alert-error ul").length==0)?$systemMessageContainer:$systemMessageContainer.find(".alert-error ul");var g=($("#system-message-container .alert-success ul").length==0)?$systemMessageContainer:$systemMessageContainer.find(".alert-success ul");switch(c){case"error":var e="error";var f=h;break;case"message":var e="success";var f=g;break}if($(f).is("ul")){f.append("<li>"+d+"</li>")}else{if($(f).is("div")){$systemMessageContainer.append('<div class="alert alert-'+e+'"><ul><li>'+d+"</li></ul></div>")}}})},suggestMember:{started:false,active:false,current:null,startCaret:0,type:"",group_id:"",inputField:null,add:function(b,a){$.ajax({type:"POST",url:S.path["group.member.add"],data:{user_id:a,group_id:S.suggestMember.group_id},dataType:"json",cache:true,success:function(d){$(".groupMemberList li.newGroupMember-separator").show();$(b).fadeOut(300,function(){$(b).remove()});var c=$('<li class="newGroupMember" />').insertAfter(".groupMemberList li:first-child");$(d.html).appendTo(c).hide().slideDown()}})},start:function(a){group_id=$(".groupMember").attr("id");S.suggestMember.group_id=group_id.match(/^\w+_([0-9]+)$/)[1];S.suggestMember.type=a;S.suggestMember.started=true;if(!S.suggestMember.active){S.suggestMember.inputField=$(".searchMembers");S.suggestMember.active=true;$(".groupMember .stream-post-suggest").slideDown();S.suggestMember.current="";S.suggestMember.startCaret=$(S.suggestMember.inputField).caret().start}},stop:function(){if(S.suggestMember.active){S.suggestMember.active=false;$(".groupMember .stream-post-suggest").slideUp()}},update:function(d){var b=d.charCode||d.keyCode;var a=String.fromCharCode(b);if(b>=65&&b<=122){var e=$(S.suggestMember.inputField).caret().start;var c=$(S.suggestMember.inputField).val();S.suggestMember.current=c.substring(S.suggestMember.startCaret,e+1);S.suggestMember.current=S.suggestMember.current+a;$.ajax({type:"POST",url:S.path["system.suggest"],data:{search:S.suggestMember.current,type:S.suggestMember.type,group_id:S.suggestMember.group_id},dataType:"json",cache:true,success:function(f){$(".groupMember .stream-post-suggest").html(f.html)}})}else{if(d.keyCode==8||d.keyCode==46){var e=($(S.suggestMember.inputField).caret().start-1);if(S.suggestMember.startCaret>=e){S.suggestMember.stop()}}else{if(a==":"||a=="|"||a=="?"||a==" "||d.keyCode==13){S.suggestMember.stop()}}}}}});$(function(){S.stream.init();S.postbox.init();S.message.init();S.comment.init();S.like.init();S.todo.init();S.event.init();S.milestone.init();S.groups.init();S.maps.init();S.search.init();S.embed.init();S.tag.init();S.customlist.init();$("li.groups a").popmodal({html:true,live:true,placement:"right",reposition:true});$(".calendar tr:not(:last) td.running").popmodal({html:true,live:true,placement:"below",height:200});$(".calendar tr:last td.running").popmodal({html:true,live:true,placement:"above",height:200,reposition:true});$('a[href="#showReaders"]').popmodal({html:true,live:true,placement:"right",reposition:true});var b=function(){var l=".side-notification a",m=$(l),k=false,n={html:true,placement:"right",trigger:"manual"};$(l).popover(n);$(l).live("click",function(){$("div.main-popover").remove();if(!k){var p=$(l).attr("data-content")||"";p=p.replace(/<\/?ul>/g,"");if(!p||p.length==0){return false}$(l).parent().addClass("active");$(l).popover("show");var o=$($("div.popover")[0]).clone()||$("div.main-popover");$("div.popover").remove();o.addClass("popover main-popover").prependTo($("body"));$(".main-popover").popScroll({height:800,sender:l});$("div.main-popover").css("top",$(l).offset().top+$(l).height());$("div.main-popover .inner").css({position:"absolute",top:-($(l).height())})}else{$(l).parent().removeClass("active");$(l).popover("hide");$("div.main-popover").remove()}k=!k});return m};var c=new b();$("div.message-content-preview img[rel]").live("click",function(){var n=function(s){if(s.keyCode==37){$(s.data.obj).children(".image_prev").trigger("click");return false}if(s.keyCode==39){$(s.data.obj).children(".image_next").trigger("click");return false}};if(!$(this).data("overlay_bind")){var l=$($(this).attr("rel")).find("img");var q=$($(this).attr("rel"));w=$(window);var o=parseInt(0.8*w.height());if(w.height()<760){if(l.attr("height")>o){newWidth=(o/l.attr("height"))*l.attr("width");l.attr("width",newWidth);$($(this).attr("rel")).width(newWidth);l.attr("height",o)}}$(this).data("overlay_bind",true);$(this).overlay({effect:"apple",onLoad:function(){$(document).bind("keydown",{obj:q},n)},onClose:function(){$(document).unbind("keydown",n)}});$(this).trigger("click")}if($.browser.msie&&$.browser.version=="9.0"){var m=$(".apple_overlay");var p=screen.width;var k=m.width();var r=(p/2-k/2);m.css({left:r})}});$('textarea[name="message"]').autoGrow();$('textarea[name="comment"]:not(.noautogrow)').autoGrow();$('a[href="#selectOption"]').live("click",function(){return S.utils.setupOptionSelect(this)});$('a[data-dismiss="alert"]').click(function(){S.alert.hide(this)});var g=function(l){l.preventDefault();var k=$(this).parents("ul");k.find("li").show();$(this).hide();k.find("li a.less").show()};var i=function(m){m.preventDefault();var l=$(this).data("limit");var k=$(this).parents("ul");k.find("li:not(.moreless)").hide().each(function(n,o){if(n>=l){return}$(o).show()});$(this).hide();k.find("li a.more").show()};$('a[href="#showAllGroups"]').bind("click",g);$('a[href="#showLessGroups"]').bind("click",i);$('a[href="#search_stream"],button[href="#search_stream"]').click(function(){$("form.form-search").toggle();return false});$(".stream-message-links-in-post").click(function(l){if(l.target.className=="tips"){return true}var k=$(this).find(".stream-message-links-url").html(),m=S.utils.getMessageId(this);S.message.isViewed(m,m,"link");window.open(k);return false});if($("#oContent").length&&$("#main-content-right").length){var a=$(".sidebar-left-inner").height();var h=$(".main-content-inner").height();var f=$(".sidebar-right-inner").height();var d=$(".sidebar-right-inner").position().top;var j=Math.max(a,h,f);$(".sidebar-right-inner").height(j)}var e=(function(){var k=$(".mini-sidebar");k.children("li").each(function(l,n){var p="mini-",o=$("#"+$(n).get("id")+"-content"),q=$("#mini-sidebar-placeholder"),m=($(q).children().length>0)||false;$(n).click(function(){$(q).empty();m=!m;if(!m){$(n).removeClass("active");return}$(n).addClass("active");var r=o.clone()||[];$(q).append(r);r.show(100);r.animate({width:$(q).width(),display:"block !important",right:"+25px"},100,function(){})})})})();if(typeof Modernizr!="undefined"){if(!Modernizr.input.placeholder){$("input").each(function(){if($(this).val()==""&&$(this).attr("placeholder")!=""){$(this).val($(this).attr("placeholder"));$(this).focus(function(){if($(this).val()==$(this).attr("placeholder")){$(this).val("")}});$(this).blur(function(){if($(this).val()==""){$(this).val($(this).attr("placeholder"))}})}})}}tinyMCE.init({mode:"none",theme:"advanced",content_css:S.path["system.root"]+"media/editors/tinymce/jscripts/tiny_mce/themes/simple/skins/default/stream_content.css",theme_advanced_buttons1:"bold,italic,underline,separator,strikethrough,justifyleft,justifycenter,justifyright,justifyfull,bullist,numlist,undo,redo,link,unlink",theme_advanced_buttons2:"",theme_advanced_buttons3:"",theme_advanced_toolbar_location:"top",theme_advanced_toolbar_align:"left",theme_advanced_statusbar_location:"bottom",paste_auto_cleanup_on_paste:true,paste_remove_styles:true,paste_remove_styles_if_webkit:true,paste_strip_class_attributes:true,plugins:"autoresize,paste",autoresize_max_height:"500px"})});